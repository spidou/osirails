<%
require_locals supply_class, supply_sub_category_class, supply_type_class, supplies_supply_sizes
supply_categories ||= []
%>

<% content_for :header do %>
  <%= stylesheet_link_tag_with_theme_support 'logistics/supply' %>
<% end %>

<% unless supply.new_record? %>
  <% add_contextual_menu_item supply.class.human_name do %>
    <% supply_action_buttons(supply).each do |button| %>
      <%= button %>
    <% end %>
  <% end %>
<% end %>

<% unless supply.new_record? %>
  <% add_contextual_menu_item supply.supply_sub_category.class.human_name do %>
    <% supply_sub_category_action_buttons(supply.supply_sub_category).each do |button| %>
      <%= button %>
    <% end %>
  <% end %>
<% end %>

<% unless supply.new_record? %>
  <% add_contextual_menu_item supply.supply_category.class.human_name do %>
    <% supply_category_action_buttons(supply.supply_category).each do |button| %>
      <%= button %>
    <% end %>
  <% end %>
<% end %>

<% add_contextual_menu_item :useful_links do %>
  <%= display_supply_list_button(supply_class) %>
<% end %>

<div class="presentation_medium">
  <h2>Caractéristiques</h2>
  <% form_for(supply) do |form| %>
    <%= form.error_messages %>
    
    <%= render :partial => 'supplies/supply_referencing', :object => supply, :locals => { :form => form,
                                                                                          :supply_class => supply_class,
                                                                                          :supply_sub_category_class => supply_sub_category_class,
                                                                                          :supply_type_class => supply_type_class,
                                                                                          :supply_categories => supply_categories } %>
    
    <fieldset>
      <legend>Spécificités</legend>
      
      <div id="supplies_supply_sizes">
        <%= render :partial => 'supplies_supply_sizes/supplies_supply_sizes_list', :object => supplies_supply_sizes,
                                                                                   :locals => { :supply => supply } %>
      </div>
    </fieldset>
    
    <fieldset class="presentation_in_columns">
      <legend>Autres caractéristiques</legend>
      
      <p>
        <%= form.label :measure %>
        <%= form.form_or_view(form.text_field(:measure, :size => 8, :value => supply.measure, :disabled => supply.has_been_used?), :measure) %>&#160;<%= display_supply_unit_measure(supply) %>
      </p>
      <p>
        <%= form.label :unit_mass %>
        <%= form.form_or_view(form.text_field(:unit_mass, :size => 8, :value => supply.unit_mass, :disabled => supply.has_been_used?), :unit_mass) %>&#160;kg
      </p>
      <p>
        <%= form.label :packaging %>
        <%= form.form_or_view(form.text_field(:packaging, :size => 8, :value => supply.packaging), :packaging) %><%= "&#160;par lot" if form.form_view? or !supply.packaging.blank? %>
      </p>
      <p>
        <%= form.label :threshold %>
        <%= form.form_or_view(form.text_field(:threshold, :size => 8, :value => supply.threshold), :threshold) %>
      </p>
    </fieldset>
    
    <% unless supply.new_record? %>
      <h2>Statistiques</h2>
      <div class="presentation_in_columns">
        <div>
          <p>
            <%= form.label :average_unit_price %>
            <%= form.strong number_with_precision(supply.average_unit_price, :precision => 2) %> &euro;
          </p>
          
          <p>
            <%= form.label :average_measure_price %>
            <%= form.strong number_with_precision(supply.average_measure_price, :precision => 2) %> &euro;/<%= display_supply_unit_measure(supply) %>
          </p>
        </div>
        
        <div>
          <p>
            <%= form.label :higher_unit_price %>
            <%= form.strong number_with_precision(supply.higher_unit_price, :precision => 2) %> &euro;
          </p>
          
          <p>
            <%= form.label :higher_measure_price %>
            <%= form.strong number_with_precision(supply.higher_measure_price, :precision => 2) %> &euro;/<%= display_supply_unit_measure(supply) %>
          </p>
        </div>
      </div>
      
      <h2>Stock actuel</h2>
      <div class="presentation_in_columns">
        <div>
          <p>
            <%= form.label :stock_quantity %>
            <%= form.strong :stock_quantity %>
          </p>
          <p>
            <%= form.label :stock_value %>
            <%= form.strong number_with_precision(supply.stock_value, :precision => 2) %> &euro;
          </p>
          <p>
            <%= form.label :average_unit_value %>
            <%= form.strong number_with_precision(supply.average_unit_stock_value, :precision => 2) %> &euro;
          </p>
        </div>
        
        <div>
          <p>
            <%= form.label :stock_measure %>
            <%= form.strong number_with_precision(supply.stock_measure, :precision => 2) %> <%= display_supply_unit_measure(supply) %>
          </p>
          <p>
            <%= form.label :stock_mass %>
            <%= form.strong number_with_precision(supply.stock_mass, :precision => 2) %> kg
          </p>
        </div>
      </div>
    <% end %>
    
    <h2 id="suppliers">Fournisseurs</h2>
    <div class="autoscroll">
      <%= display_supplier_supply_list(supply)  %>
      <%= display_supplier_supply_add_button(supply) if is_form_view? %>
    </div>
    
    <%= form.form_buttons %>
  <% end %>
</div>

<?xml version="1.0"?>
<Root>
  <Document>
    <BackgroundImage><%= "#{RAILS_ROOT}/public/fo/images/background.png" %></BackgroundImage>
    <Type>FACTURE</Type>
    <Type2><%= @invoice.invoice_type.title.upcase %></Type2>
    <Reference><%= @invoice.reference %></Reference>
    <Date><%= l(@invoice.published_on) %></Date>
    <Currency>EUROS (€)</Currency>
    <FileName><%= @invoice.order.title%></FileName>
    <Supplier>
      <CorporateName><%= ConfigurationManager.admin_society_identity_configuration_name %></CorporateName>
      <CorporateName2><%= ConfigurationManager.admin_society_identity_configuration_acronym %></CorporateName2>
      <Address1><%= ConfigurationManager.admin_society_identity_configuration_address_first_line %></Address1>
      <Address2><%= ConfigurationManager.admin_society_identity_configuration_address_second_line %></Address2>
      <ZipCode><%= ConfigurationManager.admin_society_identity_configuration_address_zip %></ZipCode>
      <City><%= ConfigurationManager.admin_society_identity_configuration_address_town %></City>
      <Country><%= ConfigurationManager.admin_society_identity_configuration_address_country %></Country>
      <Status><%= ConfigurationManager.admin_society_identity_configuration_status %></Status>
      <Siret><%= ConfigurationManager.admin_society_identity_configuration_siret %></Siret>
      <NAFCode><%= ConfigurationManager.admin_society_identity_configuration_naf_code %></NAFCode>
      <Email><%= ConfigurationManager.admin_society_identity_configuration_email %></Email>
      <Phone><%= ConfigurationManager.admin_society_identity_configuration_phone %></Phone>
      <Fax><%= ConfigurationManager.admin_society_identity_configuration_fax %></Fax>
      <CommercialRepresentative>
        <LastName><%= @invoice.order.signed_quote.commercial_actor.last_name %></LastName>
        <FirstName><%= @invoice.order.signed_quote.commercial_actor.first_name %></FirstName>
        <Phone><%= "#{@number.indicative.indicative if @number.indicative} #{@number.formatted_with_indicative}" if @number = @invoice.order.signed_quote.commercial_actor.numbers.first %></Phone>
        <Email><%= @invoice.order.signed_quote.commercial_actor.email %></Email>
      </CommercialRepresentative>
      <InvoicingActor>
        <LastName><%= @invoice.invoicing_actor.last_name %></LastName>
        <FirstName><%= @invoice.invoicing_actor.first_name %></FirstName>
        <Phone><%= "#{@number.indicative.indicative if @number.indicative} #{@number.formatted_with_indicative}" if @number = @invoice.invoicing_actor.numbers.first %></Phone>
        <Email><%= @invoice.invoicing_actor.email %></Email>
      </InvoicingActor>
      <LogoPath><%= "#{RAILS_ROOT}/public/fo/images/logo.png"%></LogoPath>
    </Supplier>
    <Customer>
      <CorporateName><%= @invoice.order.customer.name %></CorporateName>
      <CorporateName2><%= @invoice.order.customer.name %></CorporateName2>
      <Address1><%= @invoice.bill_to_address.street_name %></Address1>
      <Address2></Address2>
      <ZipCode><%= @invoice.bill_to_address.zip_code %></ZipCode>
      <City><%= @invoice.bill_to_address.city_name %></City>
      <Country><%= @invoice.bill_to_address.country_name %></Country>
      <Representative>
        <LastName><%= @invoice.invoice_contact.last_name %></LastName>
        <FirstName><%= @invoice.invoice_contact.first_name %></FirstName>
      </Representative>
    </Customer>
    <Lines>
      <% @invoice.invoice_items.each do |item| %>
        <% item_id = item.id || generate_random_id %>
        <Line>
          <Id><%= item_id %></Id>
          <% if @footlines_adjustments %>
            <% @adjust_bottom = @footlines_adjustments.include?(("item_#{item_id}").to_sym) %>
            <% if @adjust_bottom %>
              <% @padding_bottom = @footlines_adjustments[("item_#{item_id}").to_sym].round_to(2).to_s(2) %>
            <% else %>
              <% @padding_bottom = "0.3" %>
            <% end %>
          <% else %>
            <% @padding_bottom = "0.3" %>
          <% end %>
          <%= "<PaddingBottom>#{@padding_bottom}</PaddingBottom>" %>
          <% if @report_adjustment %>
            <% @adjust_report = @report_adjustment.include?(("item_#{item_id}").to_sym) %>
            <% if @adjust_report %>
              <% @is_page_first_element = @report_adjustment[("item_#{item_id}").to_sym].to_s %>
            <% else %>
              <% @is_page_first_element = "false" %>
            <% end %>
          <% else %>
            <% @is_page_first_element = "false" %>
          <% end %>
          <%= "<IsPageFirstElement>#{@is_page_first_element}</IsPageFirstElement>" %>
          <Reference><%= item.reference_object && item.reference_object.reference %></Reference>
          <Name><%= item.name %></Name>
          <Description><%= item.description %></Description>
          <Quantity><%= item.quantity %></Quantity>
          <UnitPrice><%= item.unit_price.to_f.round_to(2).to_s(2) if item.unit_price %></UnitPrice>
          <Prizegiving><%= item.prizegiving.to_f.round_to(2).to_s(2) if item.prizegiving  %></Prizegiving>
          <TotalPrice><%= item.total.to_f.round_to(2).to_s(2) if item.quantity %></TotalPrice>
          <VAT><%= @invoice.tax_coefficients.index(item.vat)+1 if item.vat %></VAT>
        </Line>
      <% end %>
    </Lines>
    <Taxes>
      <% @invoice.tax_coefficients.each_with_index do |tc,index| %>
        <VAT>
          <Code><%= index+1 %></Code>
          <Coefficient><%= tc %></Coefficient>
          <TotalDutyFreePrice><%= @invoice.total_taxes_for(tc).to_f.round_to(2).to_s(2) %></TotalDutyFreePrice>
          <TotalInclusiveOfTaxPrice><%= (@invoice.total_taxes_for(tc)*tc/100).to_f.round_to(2).to_s(2) %></TotalInclusiveOfTaxPrice>
        </VAT>
      <% end %>
    </Taxes>
    <TotalDutyFreeNetPrice><%= @invoice.total.to_f.round_to(2).to_s(2) %></TotalDutyFreeNetPrice>
    <TotalTaxes><%= @invoice.summon_of_taxes.to_f.round_to(2).to_s(2) %></TotalTaxes>
    <TotalInclusiveOfTaxNetPrice><%= @invoice.net_to_paid.to_f.round_to(2).to_s(2) %></TotalInclusiveOfTaxNetPrice>
    <SalesTerms><%= @invoice.signed_quote.sales_terms %></SalesTerms>
    <InvoicingState>
      <QuoteTotal><%= @invoice.signed_quote.net_to_paid.to_f.round_to(2).to_s(2) %></QuoteTotal>
      <TotalBilled><%= @invoice.total_billed_amount.to_f.round_to(2).to_s(2) %></TotalBilled>
      <Balance><%= @invoice.balance_to_bill_amount < 0 ? 0 : @invoice.balance_to_bill_amount.to_f.round_to(2).to_s(2) %></Balance>
    </InvoicingState>
    <DueDates>
      <% @invoice.due_dates.each do |due_date| %>
        <DueDate>
          <Date><%= l(due_date.date) %></Date>
          <Total><%= due_date.net_to_paid.to_f.round_to(2).to_s(2) %></Total>
        </DueDate>
      <% end %>
    </DueDates>
  </Document>
  <Labels>
    <Siret>SIRET :</Siret>
    <NAFCode>Code NAF :</NAFCode>
    <Email>e-mail</Email>
    <Phone>tél</Phone>
    <Fax>fax</Fax>
    <Date>Date :</Date>
    <Prefix>N°</Prefix>
    <FileName></FileName>
    <SupplierCommercialPrefix>Suivi commercial</SupplierCommercialPrefix>
    <SupplierInvoicingActorPrefix>Suivi facturation</SupplierInvoicingActorPrefix>
    <SupplierRepresentativePhone>tél</SupplierRepresentativePhone>
    <SupplierRepresentativeEmail>e-mail</SupplierRepresentativeEmail>
    <CustomerPrefix>A l'attention de</CustomerPrefix>
    <Amount>MONTANTS EN</Amount>
    <Reference>Réf.</Reference>
    <Description>Désignation produit</Description>
    <Quantity>Qté</Quantity>
    <UnitPrice>P.U. HT</UnitPrice>
    <Prizegiving>Rem.</Prizegiving>
    <GlobalPrizegiving>Remise :</GlobalPrizegiving>
    <TotalPrice>Montant HT</TotalPrice>
    <VAT>TVA</VAT>
    <VATCode>Code</VATCode>
    <TotalDutyFreePrice>Montant HT</TotalDutyFreePrice>
    <Coefficient>Taux</Coefficient>
    <TotalInclusiveOfTaxPrice>Montant TVA</TotalInclusiveOfTaxPrice>
    <TotalDutyFreeNetPrice>Net HT :</TotalDutyFreeNetPrice>
    <TotalTaxes>Total taxes :</TotalTaxes>
    <TotalInclusiveOfTaxNetPrice>NET A PAYER :</TotalInclusiveOfTaxNetPrice>
    <SalesTerms>Rappel des conditions commerciales</SalesTerms>
    <InvoicingState>État de facturation</InvoicingState>
    <QuoteTotal>Total devis (TTC) :</QuoteTotal>
    <TotalBilled>Total facturé :</TotalBilled>
    <TotalBilled2>(y compris cette facture)</TotalBilled2>
    <Balance>Reste à facturer :</Balance>
    <DueDates>Échéances</DueDates>
    <DueDatesDate>Date</DueDatesDate>
    <DueDatesReference>Réf.</DueDatesReference>
    <DueDatesTotal>Montant TTC</DueDatesTotal>
    <FormToCut><%= @invoice.due_dates.many? ? "Coupons à retourner avec chaque règlement" : "Coupon à retourner avec le règlement" %></FormToCut>
    <Subtotal>Report :</Subtotal>
    <Page>Page</Page>
  </Labels>
</Root>

<%
  require_locals model 
%>
<%= hidden_field_tag('criteria_loaded', true) %>

<% criteria.each do |attribute, options|%>
  <%
    menu_link_name = get_alias(attribute.match(/.id$/) ? attribute.chomp('.id') : attribute)
    menu_link      = content_tag(:div, display_menu_link_for(menu_link_name), :class => 'attribute')
    drop_down_menu = content_tag(:ul, @organized_filters.map {|n| generate_menu(n, attribute)}, :style => 'display:none;', :class => 'attribute_chooser')
    options        = [options] unless options.is_a?(Array)
  %>
  <% options.each do |option| %>
    <% inputs = content_tag(:span, generate_inputs_for(attribute, option), :class => 'inputs')%>
    
    <tr class='criterion'>
      <td><%= menu_link %><%= drop_down_menu %></td><td><%= inputs %></td>
    </tr>
  <% end %>
<% end %>
